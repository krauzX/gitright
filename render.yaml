services:
  - type: web
    name: gitright-api
    runtime: go
    plan: free
    buildCommand: go build -o server ./cmd/server
    startCommand: ./server
    healthCheckPath: /health
    envVars:
      - key: ENV
        value: production
      - key: HOST
        value: 0.0.0.0
      - key: LOG_LEVEL
        value: info
      - key: HTTP_TIMEOUT
        value: 300s
      - key: FRONTEND_URL
        sync: false
      - key: GITHUB_CLIENT_ID
        sync: false
      - key: GITHUB_CLIENT_SECRET
        sync: false
      - key: GITHUB_REDIRECT_URI
        sync: false
      - key: GITHUB_OAUTH_SCOPES
        value: repo,user:email
      - key: DATABASE_URL
        sync: false
      - key: DATABASE_MAX_OPEN_CONNS
        value: 5
      - key: DATABASE_MAX_IDLE_CONNS
        value: 2
      - key: DATABASE_CONN_MAX_LIFETIME
        value: 5m
      - key: SESSION_SECRET
        generateValue: true
      - key: SESSION_MAX_AGE
        value: 86400
      - key: TOKEN_ENCRYPTION_KEY
        sync: false
      - key: CORS_ALLOWED_ORIGINS
        sync: false
      - key: CORS_ALLOWED_METHODS
        value: GET,POST,PUT,DELETE,OPTIONS
      - key: CORS_ALLOWED_HEADERS
        value: Content-Type,Authorization
      - key: RATE_LIMIT_REQUESTS_PER_MINUTE
        value: 60
      - key: RATE_LIMIT_BURST
        value: 10
      - key: GOOGLE_AI_MODEL
        value: gemini-2.5-flash-preview-0409-2025
      - key: GOOGLE_AI_TIMEOUT
        value: 300s
      - key: GOOGLE_AI_MAX_RETRIES
        value: 2
